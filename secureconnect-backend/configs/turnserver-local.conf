# Coturn TURN Server Configuration - LOCAL DEPLOYMENT ONLY
# =======================================================
# This configuration is optimized for Docker Desktop local testing
# DO NOT use this configuration in production environments
#
# IMPORTANT LIMITATIONS:
# - No TLS/DTLS encryption (disabled for local testing)
# - No public IP required (uses Docker internal networking)
# - Limited to local scope only
# - Not suitable for real-world NAT traversal testing

# Listening port for STUN/TURN (UDP and TCP)
listening-port=3478

# Alternative ports for better NAT traversal
alt-listening-port=3479

# EXTERNAL IP CONFIGURATION FOR LOCAL DOCKER DESKTOP
# ==================================================
# In Docker Desktop, the container runs in a NAT network
# For local testing, we use Docker internal DNS resolution
# The external-ip is set to auto or can be omitted
# Docker Desktop will handle the NAT translation automatically
#
# NOTE: This is different from production where you would specify:
# external-ip=PUBLIC_IP/PRIVATE_IP
#
# For local testing, we rely on:
# 1. Docker network hostname resolution (container name)
# 2. Docker's built-in NAT for port mapping
# 3. No need for public IP since all peers are local

# Fingerprinting (for DTLS) - disabled for local testing
# fingerprint

# Use long-term credentials (required for TURN)
lt-cred-mech

# Realm (authentication domain) - static for local testing
realm=local.turn

# Total quota limit (in bytes) - increased for local testing
total-quota=1000

# STUN-only port (no authentication required for STUN)
# Disabled to allow TURN testing
# stun-only

# No authentication for STUN requests
# Disabled to allow TURN testing
# no-stun

# Enable verbose logging (useful for local debugging)
verbose

# Log file - mapped to Docker volume
log-file=/var/log/turnserver/turnserver.log

# Simple log format for easier reading
simple-log

# Enable IPv6 (optional, comment out if not needed)
# ipv6

# Secure STUN (TURN with TLS) - DISABLED for local testing
# cert=/etc/turnserver/cert.pem
# pkey=/etc/turnserver/pkey.pem
# ca-file=/etc/turnserver/ca.pem

# DH TLS key size (2048 or 4096) - not needed without TLS
# dh2066

# Mobility with ICE (MICE)
mobility

# Channel binding (RFC 5766)
channel-binding

# No-loopback-peers (prevent connections to self)
no-loopback-peers

# No-multicast-peers (prevent multicast)
no-multicast-peers

# Max message size (in bytes) - increased for local testing
max-bps=5000000

# Min port for UDP relay allocations
# Using safe range for Windows compatibility
# Windows reserves ports in 49152-65535 and some in 50000-50100
# Using 40000-40020 range (20 ports) to prevent resource exhaustion
min-port=40000

# Max port for UDP relay allocations
# Reduced to 20 ports for local testing (prevents 100% CPU/RAM/Disk usage)
max-port=40020

# Redis for user authentication (optional, for dynamic credentials)
# Disabled for local testing - using static credentials
# redis-statsdb="ip=redis port=6379"

# Use Redis for user database
# Disabled for local testing
# userdb=/var/lib/turn/turndb

# Static user credentials (for local development/testing)
# Format: user=username:password
# These credentials are set via environment variables in docker-compose
# Example: user=turnuser:turnpassword
# The actual values will be injected via the user CLI option in docker-compose

# Time to live for allocations (in seconds)
# Increased for local testing (default is 600 seconds / 10 minutes)
stale-nonce=3600

# Deny Peer IP (for security) - relaxed for local testing
# In local Docker network, we allow all internal IPs
# denied-peer-ip=0.0.0.0-0.255.255.255

# Allowed Peer IP (whitelist) - allow Docker network range
# Docker bridge network typically uses 172.16.0.0/12 or 192.168.0.0/16
allowed-peer-ip=0.0.0.0/0

# CLI password for turnadmin
# cli-password=your_cli_password

# Web admin (optional) - disabled for local testing
# web-admin-ip=127.0.0.1
# web-admin-port=8080
# web-admin-user=admin
# web-admin-password=admin

# Prometheus metrics (optional) - disabled for local testing
# prometheus
# prometheus-port=9641

# ============================================
# PRODUCTION vs LOCAL CONFIGURATION DIFFERENCES
# ============================================
#
# FEATURE                    | PRODUCTION    | LOCAL (THIS FILE)
# --------------------------|---------------|------------------
# TLS/DTLS                  | ENABLED       | DISABLED
# Public IP                 | REQUIRED      | NOT REQUIRED
# Domain Name               | REQUIRED      | NOT REQUIRED
# External IP Mapping       | MANDATORY     | AUTO/OMITTED
# Certificate Files         | REQUIRED      | NOT REQUIRED
# Strict IP Filtering       | ENABLED       | RELAXED
# Log Level                 | WARNING/ERROR | VERBOSE
# Quota Limits              | STRICT        | RELAXED
#
# ============================================
# WHY THESE FEATURES ARE DISABLED LOCALLY
# ============================================
#
# 1. TLS/DTLS: Requires valid certificates and domain names.
#    In local Docker Desktop, we don't have a public domain or CA-signed certs.
#    Self-signed certs can work but add complexity for local testing.
#
# 2. Public IP: Docker Desktop uses NAT networking. The container's IP is
#    internal to the Docker network. Docker handles port mapping automatically.
#
# 3. Domain Name: Local testing uses Docker's internal DNS (container names).
#    No need for public DNS resolution.
#
# 4. IP Filtering: In local development, we want to allow connections from
#    any local peer (browser tabs, containers, etc.).
#
# ============================================
